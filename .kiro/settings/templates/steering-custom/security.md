# セキュリティ標準

[目的: 検証、認可、シークレット、データのパターンを持つセキュリティ態勢を定義]

## 哲学
- 多層防御。最小権限。デフォルトでセキュア。クローズドで失敗
- 境界で検証。コンテキストに応じてサニタイズ。入力を信用しない
- 認証（誰か）と認可（何ができるか）を分離

## 入力 & 出力
- API境界とUIフォームで検証。型と制約を強制
- 宛先に基づいてサニタイズ/エスケープ（HTML、SQL、シェル、ログ）
- ブロックリストより許可リストを優先。最小限の詳細で早期に拒否

## 認証 & 認可
- 認証: 身元を検証。短命トークン/セッションを発行
- 認可: アクション前に権限をチェック。デフォルトで拒否
- ポリシーを集中化。コード全体でのチェック重複を避ける

パターン:
```typescript
if (!user.hasPermission('resource:action')) throw ForbiddenError();
```

## シークレット & 設定
- シークレットは決してコミットしない。シークレットマネージャーまたは環境変数に保存
- 定期的にローテーション。アクセスを監査。スコープを最小限に
- 起動時に必要な環境変数を検証。欠落時は早期に失敗

## 機密データ
- 収集を最小化。ログでマスク/編集。保存時と転送時に暗号化
- ロール/必要性でアクセスを制限。機密レコードへのアクセスを追跡

## セッション/トークンセキュリティ
- 可能な限りhttpOnly + secureクッキー。あらゆる場所でTLS
- 短い有効期限。リフレッシュ時にローテーション。ログアウト/侵害時に失効
- トークンをオーディエンス/発行者にバインド。最小限のクレームを含める

## ロギング（セキュリティ意識）
- 認証試行、権限拒否、機密操作をログ
- パスワード、トークン、シークレット、完全なPIIは決してログしない。機密データを含む完全なボディを避ける
- イベントを相関させるためrequestIdとコンテキストを含める

## ヘッダー & トランスポート
- TLSを強制。HSTS
- セキュリティヘッダーを設定（CSP、X-Frame-Options、X-Content-Type-Options）
- 最新の暗号を優先。弱いプロトコル/暗号を無効化

## 脆弱性態勢
- セキュアなライブラリを優先。依存関係を最新に保つ
- CIで静的/動的スキャン。追跡と修正
- 一般的なクラスについてチームを教育。上記のパターンとしてエンコード

---
_パターンと原則に焦点を当てる。具体的な設定は運用ドキュメントにリンク。_
