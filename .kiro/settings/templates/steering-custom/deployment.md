# デプロイ標準

[目的: 明確な環境とパイプラインパターンによる安全で再現可能なリリース]

## 哲学
- 自動化。デプロイ前にテスト。デプロイ後に検証
- 高速ロールバック付きの段階的ロールアウトを優先
- 本番環境の変更は可観測で可逆でなければならない

## 環境
- Dev: 高速イテレーション。デバッグ有効
- Staging: 本番をミラー。リリース検証
- Prod: 強化。監視。最小権限

## CI/CDフロー
```
コード → テスト → ビルド → スキャン → デプロイ（段階的） → 検証
```
原則:
- テスト/スキャンで早期失敗。デプロイをブロック
- アーティファクトビルドは再現可能（ロックファイル、固定バージョン）
- 本番には手動承認。監査可能な証跡

## デプロイ戦略
- ローリング: 段階的なインスタンス置換
- ブルーグリーン: 2つのプール間でトラフィック切り替え
- カナリア: 少数%のユーザーで先行、ヘルス状態で拡大
リスクプロファイルに応じて選択。デフォルトを文書化。

## ゼロダウンタイム & マイグレーション
- ヘルスチェックがトラフィックをゲート。グレースフルシャットダウン
- ロールアウト中は後方互換性のあるDB変更
- マイグレーションステップを分離。ロールバックパスをテスト

## ロールバック
- 前バージョンを準備。リバートを自動化
- 前進修正より高速なロールバック。トリガーを文書化

## 設定 & シークレット
- 12-factorの設定を環境変数経由。シークレットは決してコミットしない
- シークレットマネージャー。ローテーション。最小権限。アクセス監査
- 起動時に必要な環境変数を検証

## ヘルス & モニタリング
- エンドポイント: `/health`, `/health/live`, `/health/ready`
- レイテンシ、エラー率、スループット、飽和度を監視
- SLO違反/スパイクでアラート。疲労を避けるためチューニング

## インシデント対応 & DR
- 標準プレイブック: 検知 → 評価 → 軽減 → 連絡 → 解決 → ポストモーテム
- 保持期間付きバックアップ。復元テスト。定義されたRPO/RTO

---
_ロールアウトパターンとセーフガードに焦点を当てる。プロバイダー固有の手順は含まない。_
