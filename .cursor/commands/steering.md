<meta>
description: .cursor/steering/ を永続的なプロジェクト知識として管理
</meta>

# Kiro ステアリング管理

<background_information>
**役割**: `.cursor/steering/` を永続的なプロジェクトメモリとして維持。

**ミッション**:
- ブートストラップ: コードベースからコアステアリングを生成（初回）
- 同期: ステアリングとコードベースの整合性を維持（メンテナンス）
- 保持: ユーザーのカスタマイズは神聖、更新は追加的に

**成功基準**:
- ステアリングは網羅的なリストではなく、パターンと原則をキャプチャ
- コードのドリフトを検出して報告
- すべての `.cursor/steering/*.md` を同等に扱う（コア＋カスタム）
</background_information>

<instructions>
## シナリオ検出

`.cursor/steering/` のステータスを確認:

**ブートストラップモード**: 空 または コアファイル（product.md, tech.md, structure.md）が不足  
**同期モード**: すべてのコアファイルが存在

---

## ブートストラップフロー

1. `.cursor/templates/steering/` からテンプレートを読み込み
2. コードベースを分析（JIT）:
   - `glob_file_search` でソースファイルを検索
   - `read_file` で README、package.json などを読み込み
   - `grep` でパターンを検索
3. パターンを抽出（リストではなく）:
   - Product: 目的、価値、コア機能
   - Tech: フレームワーク、決定事項、規約
   - Structure: 構成、命名、インポート
4. ステアリングファイルを生成（テンプレートに従う）
5. `.cursor/rules/steering-principles.md` から原則を読み込み
6. レビュー用にサマリーを提示

**フォーカス**: ファイル/依存関係のカタログではなく、決定をガイドするパターン。

---

## 同期フロー

1. すべての既存ステアリングを読み込み（`.cursor/steering/*.md`）
2. コードベースの変更を分析（JIT）
3. ドリフトを検出:
   - **ステアリング → コード**: 不足要素 → 警告
   - **コード → ステアリング**: 新パターン → 更新候補
   - **カスタムファイル**: 関連性をチェック
4. 更新を提案（追加的、ユーザーコンテンツを保持）
5. 報告: 更新、警告、推奨事項

**更新哲学**: 置換ではなく追加。ユーザーセクションを保持。

---

## 粒度の原則

`.cursor/rules/steering-principles.md` より:

> "新しいコードが既存パターンに従う場合、ステアリングの更新は不要であるべき。"

網羅的なリストではなく、パターンと原則を文書化。

**悪い例**: ディレクトリツリー内のすべてのファイルをリスト  
**良い例**: 例を用いて構成パターンを説明

</instructions>

## ツールガイダンス

- `glob_file_search`: ソース/設定ファイルを検索
- `read_file`: ステアリング、ドキュメント、設定を読み込み
- `grep`: パターンを検索
- `list_dir`: 構造を分析

**JIT戦略**: 事前ではなく必要時に取得。

## 出力説明

チャットサマリーのみ（ファイルは直接更新）。

### ブートストラップ:
```
✅ ステアリング作成完了

## 生成:
- product.md: [簡単な説明]
- tech.md: [主要スタック]
- structure.md: [構成]

レビューして信頼できる情報源として承認してください。
```

### 同期:
```
✅ ステアリング更新完了

## 変更:
- tech.md: React 18 → 19
- structure.md: APIパターン追加

## コードドリフト:
- コンポーネントがインポート規約に従っていない

## 推奨:
- api-standards.md の検討を
```

## 例

### ブートストラップ
**入力**: 空のステアリング、React TypeScriptプロジェクト  
**出力**: パターンを含む3ファイル - "Feature-first"、"TypeScript strict"、"React 19"

### 同期
**入力**: 既存ステアリング、新しい `/api` ディレクトリ  
**出力**: structure.md を更新、非準拠ファイルにフラグ、api-standards.md を提案

## 安全性とフォールバック

- **セキュリティ**: キー、パスワード、シークレットを含めない（原則参照）
- **不確実性**: 両状態を報告、ユーザーに確認
- **保持**: 疑わしい場合は置換より追加

## 注記

- すべての `.cursor/steering/*.md` はプロジェクトメモリとして読み込まれる
- テンプレートと原則はカスタマイズ用に外部化
- カタログではなくパターンにフォーカス
- "黄金律": パターンに従う新コードはステアリング更新不要
- エージェント固有のツールディレクトリ（`.cursor/`、`.gemini/`、`.claude/` など）の文書化を避ける
- `.cursor/rules/` や `.cursor/templates/` のコンテンツはステアリングファイルに文書化すべきではない（設定はメタデータ、プロジェクト知識ではない）
- `.cursor/specs/` と `.cursor/steering/` への軽い参照は許容

</output>
</output>

